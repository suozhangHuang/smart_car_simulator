# 智能小车仿真器
## 计划一说明文档

## 任务说明
1. 调研小车类型，具体是调研各高校比赛所使用的常见类型(s)
2. 调研比赛类型，（是否有多车的比赛）(j,s)
3. 规划所需的类(j,s)

## 调研内容

### 调研小车类型，具体是调研各高校比赛所使用的常见类型

#### 1. 智能小车 51单片机套件diy底盘寻迹避障开发板编程机器人配件C51

<a href="https://item.taobao.com/item.htm?spm=a230r.1.14.42.f9d12a95O54pmx&id=614513638436&ns=1&abbucket=7#detail">
    智能小车51单片机套件diy
</a>

小车的机械结构1为前轮使用**万向轮**，后轮使用两个**减速电机驱动独立轮子**。
通过控制后轮两个电机的不同转速实现转向。
<img src="https://img.alicdn.com/imgextra/i3/3367794650/O1CN01yzW0jt1kDkIVBs3qP_!!3367794650.jpg"></img>

小车的机械结构2为前后轮均使用**减速电机驱动独立轮子**。通过控制四个电机的不同转速实现转向。
<img src="https://img.alicdn.com/imgextra/i2/3367794650/O1CN01ToO6i91kDkIU9oW53_!!3367794650.jpg"></img>

小车包含的模块包括

|模块分类|具体模块|
|---|---|
|遥控模块|红外遥控器，无线接收模块与无线遥控器|
|通信模块|蓝牙模块，WIFI模块|
|机械测量模块|超声测距模块，舵机云台（可以安装超声测距模块），测速模块与测速码盘|
|显示模块|LCD液晶模块|
|外部信息监测模块|红外颜色监测模块|

#### 2.  树莓派阿克曼 ros机器人智能小车SLAM激光雷达建图导航定位

<a href="https://item.taobao.com/item.htm?spm=a230r.1.14.49.f9d12a95O54pmx&id=619482724674&ns=1&abbucket=7#detail">
    树莓派阿克曼 ros机器人智能小车
</a>

小车的机械结构为前轮使用**舵机控制方向的被动轮**，后轮使用**减速电机驱动的同速驱动轮**。通过控制舵机的输出角度实现转向。
<img src="https://img.alicdn.com/imgextra/i2/2576417441/O1CN01dp2cQn24q1iuAMFG8_!!2576417441.jpg"></img>

小车包含的模块包括

|模块分类|具体模块|
|---|---|
|通信模块|树莓派内置WIFI模块|
|电机控制|电机速度PID控制|
|机械测量模块|加速度陀螺仪|
|外部信息监测模块|云台摄像头模块，激光雷达模块|

小车通过激光雷达建立周围环境的点云，从而实现碰撞监测与路径规划，室内定位，动态避障等。通过使用摄像头信息
进行opencv人脸检测等图像识别功能。

<img src="https://img.alicdn.com/imgextra/i1/2576417441/O1CN016e4fS824q1ir9tVDQ_!!2576417441.png"></img>


#### 3. microbit智能车Qtruck创客教育套件可编程机器人巡线寻迹智能小车

<a href="https://img.alicdn.com/imgextra/i3/375997250/O1CN01akZNCc23QY43TI2Ev_!!375997250.jpg">
    microbit智能车
</a>

小车的机械结构为使用左右双履带，其中履带分别通过一个电机进行速度控制，通过控制两条履带的不同转速实现转向。
<img src="https://img.alicdn.com/imgextra/i3/375997250/O1CN01akZNCc23QY43TI2Ev_!!375997250.jpg"></img>

|模块分类|具体模块|
|---|---|
|遥控模块|无线遥控器，手机APP-Wifi模块|
|通信模块|蓝牙模块，WIFI模块|
|机械测量模块|超声测距模块，舵机云台（可以安装超声测距模块），位置反馈电机，加速度陀螺仪|
|外部信息监测模块|声音强度传感器，多路红外颜色监测模块，电子罗盘，温度传感器|
|显示模块|LED点阵|
|机械控制设备|小型机械爪|

#### 4. 51单片机四驱智能小车 4WD麦轮循迹避障智能车 全向轮移动机器人

<a href="https://item.taobao.com/item.htm?spm=a230r.1.14.111.f9d12a95O54pmx&id=615382662492&ns=1&abbucket=7#detail">
    4WD麦轮循迹避障智能车
</a>

小车的轮子使用麦克纳姆轮实现任意方向的移动，以及任意角度的旋转。使用减速直流电机控制麦克纳姆全向轮。

<img src="https://img.alicdn.com/imgextra/i4/167026790/O1CN015GEEVV201rsXUoxFB_!!167026790.jpg">
</img>


#### 5. STM32平衡车双轮两轮自平衡小车PID智能小车开发机器人学习套件

<a href="https://item.taobao.com/item.htm?spm=a230r.1.14.199.f9d12a95O54pmx&id=614648636825&ns=1&abbucket=7#detail">
    平衡车双轮两轮自平衡小车
</a>

小车左右分别使用独立的**高精度步进电机**，通过使用加速度传感器进行加速度测量，通过PID控制实现平衡车姿态控制。包括保持平衡车直立，两轮同速前进，两轮差速转向。

<img src="https://img.alicdn.com/imgextra/i3/3033560695/O1CN01WzvpJj1H0LsNz3hjH_!!3033560695.png"></img>

#### 6. STM32智能小车PID测速PID闭环控制 电机控制 循迹避障蓝牙遥控

<a href="https://item.taobao.com/item.htm?spm=a230r.1.14.305.f9d12a95O54pmx&id=612038286248&ns=1&abbucket=7#detail">
    智能小车 PID闭环电机控制
</a>

小车左右分别使用独立的**编码直流减速电机**，通过PID控制电机转速，实现类似于高精度步进电机的作用。其他部分同步进电机平衡车。

<img src="https://img.alicdn.com/imgextra/i4/96192278/O1CN01YLV9DT1ShMoxEHgBR_!!96192278.jpg"></img>

#### 7. 全国大学生智能汽车竞赛文档中规定的车模

<a href="https://smartcar.cdstm.cn/index/fontWjss/0bcaeafe167b486798aecd97e0c2904b/7/4bf8f63b4a754930bc1fb50a20661fd7/f64f584487a245f8911b78bf37a3452f.html">
    第15届智能车竞赛相关文档 下载网页
</a>

<br>

<a href="https://smartcar.cdstm.cn:8083/ueditor/jsp/upload/file/1583805175594019939.pdf">
    第十五届全国大学生智能汽车竞赛竞速比赛规则.pdf
</a>




### 调研比赛类型（是否有多车的比赛）

#### 1. 全国大学生智能汽车竞赛 比赛规则

<a href="https://smartcar.cdstm.cn:8083/ueditor/jsp/upload/file/1583805175594019939.pdf">
    第十五届全国大学生智能汽车竞赛竞速比赛规则.pdf
</a>
<br></br>

赛道简述：**赛道两侧具有标线，小车必须在赛道两侧标线之间进行移动**。

+ 基础四轮车模组

比赛是在PVC赛道上进行，赛道采用黑色边线和电磁进行导引。赛道中可能存在的元素包括表2中所有的元素。

选手制作的车模完成从车库触发沿着赛道运行一周，然后在返回车库。比赛时间从车模冲过起跑线到重新回到起跑线为止。如果车模没有能够停止在车库内停车区内，比赛时间加罚五秒钟。

+ 直立节能车模组

比赛是在PVC赛道上进行，赛道采用黑色边线和电磁进行导引。赛道中可能存在的元素包括表2中所有的元素。

比赛赛道发车区中安放有无线发射线圈，通过交变电流，产生交变磁场。车模通过接收线圈获得电能，对车模上的储能法拉电容进行充电。关于无线充电线圈具体技术规格以及制作方式，无线接收线圈的规格以及制作方式将会另行发布文档进行说明。

车模上不允许安装任何电能储能器件，车模运行的能源来自于无线接收线圈感应电流提供的电能。

车模在进入比赛场地前，车模上的储能电容需要经过放电，电容两端直流电压小于0.1V。比赛计时从无线充电线圈通电后计时。车模从车库出发和停止在车库的要求与基础四轮组要求相同。

+ 双车接力组

一辆车模在赛道中间指定位置停止。一辆车模从车库出发，到达中间车模位置时，将车上的一个尺寸不小于40厘米见方的球体传递给第二辆车模，第二辆车模带着球体返回车库。

传递的球体可以使用用标准的乒乓球，或者高尔夫球。也可以另外自制其他材质的球体，只要其直径不小于40毫米即可。

+ 声音信标组

对抗组的比赛场地设置在平整的地面上，并铺设有单一颜色的广告布或者地毯。场地四周铺设5cm宽度的黄色胶带。比赛区域约为5米×7米。车模发车区域位于比赛场地一角，由2.5厘米黑色胶带标记区域。发车区域长宽都是50cm。

比赛区域内随机安放有5至10个左右的信标，它们统一由比赛计时系统控制。

比赛包括排位预赛和对抗决赛两个阶段。

**第一阶段是排位预赛**。选手制作的车模开始位于发车区域内，此时所有的信标都是关闭状态。开始比赛后，比赛系统自动会启动第一个信标，信标会发送声音和无线射频导引信号。此时选手的车模能够识别确定信标的方位并做定向运动。

当车模上安放的磁标进入信标附近的感应线圈后，比赛系统会自动切换到下一个信标，车模随机前往第二个打开的信标。此过程将会进行10次左右。最终比赛时间是从当一个信标启动，到最后一次信标关闭为止。

**第二阶段是对抗决赛**。在对抗决赛中，则按照预赛成绩进行配对分组对抗比赛。两个车队的车模同时在场内，按照熄灭信标的多少决出胜负。

信标对抗组别中的磁标最多允许安装四个。磁标距离车模底盘或者车轮直线距离不超过5厘米，距离地面高度不超过2厘米。

#### 2. （找不到文档）早期飞思卡尔智能车竞赛

赛道简述：**赛道中央具有标线，小车必须横跨在中央标线上进行移动，两侧的轮子必须分别位于标线的两边**。

比赛分为三组，即摄像头组，光电组与平衡组。
其中**摄像头组**使用摄像头分辨赛道中央的标线，从而横跨在标线上进行移动。
**光电组**使用光电模块，即红外模块检测中央标线。
**平衡组**不限制使用的检测模块，但是要求使用两轮平衡车完成整个比赛。

比赛规则为不发生越线情况下进行竞速。


### 规划仿真器使用的类

#### 小车的建模

小车根据机械结构可以分成若干类，分别为

1. 万向轮前轮+独立平行双后轮
2. 舵机自由前轮+同速平行双后轮（阿克曼转向）
3. 独立平行双履带
4. 四个麦克纳姆轮
5. 双独立平行轮（自平衡车）
6. 自由全向轮前轮+独立平行双后轮

当小车具有不同的机械结构时，小车能够进行的运动方式是完全不同的。根据能够实现的运动方式，可以将小车分类成以下几类。

1. **不能够原地转向（1.5自由度）**
   这一类只包括<font color="red">2. 舵机自由前轮+同速平行双后轮（阿克曼转向）</font>结构的小车。
   这一种小车通过控制前轮舵机来控制前进方向，但是必须要前进才能够体现出前进方向的改变。或者可以认为，这种小车能够绕行的旋转轴不在小车范围内。更具体地可以认为这类小车的转弯半径有最小值。

    <center>
    <img src="https://latex.codecogs.com/gif.latex?\begin{aligned}&space;&&space;R&space;=&space;\sqrt{\frac{DL}{tan\theta}&plus;\frac{D^2}{4}-L^2}&space;\\&space;&&space;\theta&space;=&space;arctan(\frac{4DL}{4R^2&plus;4L^2-D^2})&space;\end{aligned}" />
    </center>

   公式中R为后轮中心的转弯半径，<img src="https://latex.codecogs.com/gif.latex?\theta" />为阿克曼转向角，即前轮在转向时的夹角，D为轮距，L为轴距。

2. **能够原地转向，但是不能任意方向移动（2自由度）**
   这一类包括了<font color="red">1. 万向轮前轮+独立平行双后轮</font>，<font color="red">3. 独立平行双履带</font>，<font color="red">5. 双独立平行轮（自平衡车）</font>以及<font color="red">6. 自由全向轮前轮+独立平行双后轮四类小车</font>。
   这类小车都能够设置平行轮之间的速度差，从而绕小车范围内特定轴旋转。更具体地可以认为这类小车具有任意的转弯半径（绕平行轮中点）。

3. **能够原地转向，并且能够任意方向移动（3自由度）**
   这一类只包括<font color="red">4. 四个麦克纳姆轮结构的小车</font>一种结构。
   这类小车对角线上的两个轮子可以产生平行的力，而相邻的两个轮子产生的力相互垂直，因此可以控制小车在任意方向上受力，从而驱动小车向任意方向移动。
   同时在对角线上的两个轮子上产生的力不共线，因此可以产生任意竖直轴进行旋转。

对三类小车可以分别进行接口约定

1. **不能够原地转向（1.5自由度）**

|接口名|接口说明|
|---|---|
|set_speed(speed)|设置前进方向上的速度(允许为负)|
|set_Ackermann_steering_angle(theta)|设置阿克曼转向角（可以用于计算转弯半径）|
|set_steering_radius(r)|设置转弯半径|

|参数名|参数说明|
|---|---|
|width|小车宽度|
|length|小车长度|
|front_tread|小车前轮间距（前轮距）|
|back_tread|小车后轮间距（后轮距）|
|wheelbase|小车前后轮距离（轴距）|
|back_wheel_pos|小车后轮位置（与车前方的距离）|
|Ackermann_steering_angle_max|最大阿克曼转向角|
|forward_speed_max|最大前进速度|
|backward_speed_max|最大后退速度|

2. **能够原地转向，但是不能任意方向移动（2自由度）**
   
|接口名|接口说明|
|---|---|
|set_left_speed(speed)|设置左轮速度(允许为负)|
|set_right_speed(speed)|设置右轮速度(允许为负)|
|set_speed(speed, steering_radius)|设置前进方向上的速度与转弯半径（必须同时设置以求解出两个轮子的速度）|

|参数名|参数说明|
|---|---|
|width|小车宽度|
|length|小车长度|
|back_tread|小车后轮间距（后轮距）|
|back_wheel_pos|小车后轮位置（与车前方的距离）|
|forward_speed_max|最大前进速度|
|backward_speed_max|最大后退速度|

3. **能够原地转向，并且能够任意方向移动（3自由度）**
 
|接口名|接口说明|
|---|---|
|set_front_left_speed(speed)|设置左前轮速度(允许为负)|
|set_front_right_speed(speed)|设置右前轮速度(允许为负)|
|set_back_left_speed(speed)|设置左后轮速度(允许为负)|
|set_back_right_speed(speed)|设置右后轮速度(允许为负)|
|set_speed(speed_d, speed_q, steering_speed)|设置速度方向大小，以及绕中心的旋转速度（必须同时设置以求解出四个轮子的速度）|

|参数名|参数说明|
|---|---|
|width|小车宽度|
|length|小车长度|
|front_tread|小车前轮间距（前轮距）|
|back_tread|小车后轮间距（后轮距）|
|wheelbase|小车前后轮距离（轴距）|
|back_wheel_pos|小车后轮位置（与车前方的距离）|
|speed_max|最大速度|


从而可以让小车通过两部分进行实现。第一部分的由机械结构实现对应类型的小车接口，即根据机械结构，通过控制小车上的电机来实现小车的移动接口。第二部分为通过小车的移动接口实现具体的算法，从而完成比赛。

考虑到这两个部分是解耦的，可以优先实现第二个部分。假设仿真中使用的所有小车都是已经实现了移动接口的，那么可以只使用小车的移动接口以及机械大小来完成整个仿真控制部分。

作为额外的部分，可以考虑对第一部分也进行仿真器部分的设计。通过简单实现小车的模型，对小车控制的算法进行时序仿真。可以考虑直接将整个部分包装成PID算法调参。
